# linux-persistence-malware
C code for shared library hijacking and function hooking

The library hijacking code (in 'hijack' folder) will run shellcode as a child process whenever the libgpg-error.so.0 library is loaded for a program. To see if a program loads this library, use the 'ldd' command. For example, the ps command loads this library, so run 'ldd /usr/bin/ps'. Note that this method may break some functionality of programs, which is why a library that may have less impact if broken was chosen.

The function hooking code (in 'hook' folder) will save a pointer to the real geteuid() function, then runs shellcode as a child process. Afterwards it runs the real geteuid() code to avoid breaking any functionality. To check if a programa runs this function, use the 'ltrace' command (ex: ltrace /usr/bin/cp). Many programs will run this function such as cp and id.

## Usage:
Replace the SHELLCODE_HERE variable with shellcode that has been modified by crypt.c (or manually XOR each byte by 0x39). The 'hijack' folder contains necessary files to perform library hijacking against libgpg-error.so.0, and the 'hook' folder contains files to perform function hooking against the geteuid function. This code is meant for x64 Linux systems.

Instructions for compiling code in the folders can be found in the C files' code comments. The run.sh scripts will automate the setup of either method by adding lines to .bashrc and/or .zshrc to set environment variables that will load the compiled code. Both scripts also set an alias for sudo, so if the shellcode is run due to a command that was run with sudo, the shellcode will be executed as the root user.
